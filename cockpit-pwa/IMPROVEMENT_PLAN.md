# Cockpit PWA - åœ§å€’çš„ UI/UX æ”¹å–„è¨ˆç”»

## ç¾çŠ¶åˆ†æï¼ˆCritical Issuesï¼‰

### ğŸ”´ P0: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å®Œå…¨æ¬ è½
1. **ã‚³ãƒãƒ³ãƒ‰é€ä¿¡å¾Œã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãªã—** - é€ä¿¡ã•ã‚ŒãŸã‹ä¸æ˜
2. **ãƒˆãƒ¼ã‚¹ãƒˆ/é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ãªã—** - æˆåŠŸ/ã‚¨ãƒ©ãƒ¼ãŒä¼ã‚ã‚‰ãªã„
3. **WebSocket ã‚¨ãƒ©ãƒ¼è©³ç´°ãªã—** - ä½•ãŒèµ·ããŸã‹ä¸æ˜
4. **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãŒé™å®šçš„** - å¾…æ©Ÿä¸­ã‹å®Œäº†ã‹ä¸æ˜

---

## æ”¹å–„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FUGUE Cockpit - Enhanced UX Architecture               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Toast Provider (sonner)                         â”‚    â”‚
â”‚  â”‚  - success / error / warning / info / loading    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†‘                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      â”‚                           â”‚    â”‚
â”‚  â”‚  CommandInput â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ Toast feedback        â”‚    â”‚
â”‚  â”‚    - Loading spinner â”‚                           â”‚    â”‚
â”‚  â”‚    - Optimistic UI   â”‚                           â”‚    â”‚
â”‚  â”‚    - Command history â”‚                           â”‚    â”‚
â”‚  â”‚                      â”‚                           â”‚    â”‚
â”‚  â”‚  useWebSocket â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ Connection toasts     â”‚    â”‚
â”‚  â”‚    - Error details   â”‚                           â”‚    â”‚
â”‚  â”‚    - Retry progress  â”‚                           â”‚    â”‚
â”‚  â”‚                      â”‚                           â”‚    â”‚
â”‚  â”‚  REST API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ Error toasts          â”‚    â”‚
â”‚  â”‚    - Per-endpoint    â”‚                           â”‚    â”‚
â”‚  â”‚                      â”‚                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  MessageLog (New Component)                      â”‚    â”‚
â”‚  â”‚  - ã‚³ãƒãƒ³ãƒ‰å±¥æ­´ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å¯è¦–åŒ–              â”‚    â”‚
â”‚  â”‚  - ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ã                            â”‚    â”‚
â”‚  â”‚  - æŠ˜ã‚ŠãŸãŸã¿å¯èƒ½                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 1: ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ å°å…¥

### 1.1 sonner ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå°å…¥
```bash
npm install sonner
```

### 1.2 Toast Provider è¨­å®š (`layout.tsx`)
```tsx
import { Toaster } from 'sonner';

<Toaster
  position="top-center"
  richColors
  closeButton
  duration={4000}
/>
```

### 1.3 ãƒˆãƒ¼ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³å®šç¾©

| ã‚¤ãƒ™ãƒ³ãƒˆ | ã‚¿ã‚¤ãƒ— | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | æŒç¶šæ™‚é–“ |
|---------|--------|-----------|---------|
| ã‚³ãƒãƒ³ãƒ‰é€ä¿¡ | loading â†’ success | ã€Œé€ä¿¡ä¸­...ã€â†’ã€Œé€ä¿¡å®Œäº†ã€ | 2s |
| ã‚³ãƒãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼ | error | ã€Œé€ä¿¡å¤±æ•—: {reason}ã€ | 5s |
| WebSocket æ¥ç¶š | success | ã€Œæ¥ç¶šã—ã¾ã—ãŸã€ | 2s |
| WebSocket åˆ‡æ–­ | warning | ã€Œæ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã¾ã—ãŸã€‚å†æ¥ç¶šä¸­...ã€ | âˆ |
| WebSocket ã‚¨ãƒ©ãƒ¼ | error | ã€Œæ¥ç¶šã‚¨ãƒ©ãƒ¼: {details}ã€ | 5s |
| å†æ¥ç¶šæˆåŠŸ | success | ã€Œå†æ¥ç¶šã—ã¾ã—ãŸã€ | 2s |
| æœ€å¤§è©¦è¡Œåˆ°é” | error | ã€Œæ¥ç¶šã§ãã¾ã›ã‚“ã€‚æ‰‹å‹•ã§å†æ¥ç¶šã—ã¦ãã ã•ã„ã€ | âˆ |
| REST API ã‚¨ãƒ©ãƒ¼ | error | ã€Œ{endpoint} ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€ | 5s |

---

## Phase 2: CommandInput å¼·åŒ–

### 2.1 é€ä¿¡çŠ¶æ…‹ç®¡ç†
```tsx
type SendState = 'idle' | 'sending' | 'success' | 'error';

const [sendState, setSendState] = useState<SendState>('idle');
```

### 2.2 ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° UI
- é€ä¿¡ãƒœã‚¿ãƒ³: Spinner + disabled
- å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: åŠé€æ˜ + disabled
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 5ç§’ã§ error çŠ¶æ…‹

### 2.3 Optimistic UI
- é€ä¿¡ç›´å¾Œã«å…¥åŠ›ã‚¯ãƒªã‚¢
- å¤±æ•—æ™‚ã«å…¥åŠ›ã‚’å¾©å…ƒ + ã‚¨ãƒ©ãƒ¼ãƒˆãƒ¼ã‚¹ãƒˆ

### 2.4 ã‚³ãƒãƒ³ãƒ‰å±¥æ­´ï¼ˆä¸Šä¸‹ã‚­ãƒ¼ï¼‰
- æœ€æ–°10ä»¶ã‚’è¨˜æ†¶
- â†‘â†“ ã§å±¥æ­´ã‚’ãƒŠãƒ“ã‚²ãƒ¼ãƒˆ

---

## Phase 3: MessageLog ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ–°è¨­

### 3.1 ç›®çš„
ã‚³ãƒãƒ³ãƒ‰ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®**å¯è¦–åŒ–**

### 3.2 æ§‹é€ 
```tsx
interface LogEntry {
  id: string;
  type: 'command' | 'response' | 'error' | 'system';
  content: string;
  timestamp: Date;
  status?: 'pending' | 'success' | 'error';
}
```

### 3.3 è¡¨ç¤ºå½¢å¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ã‚³ãƒãƒ³ãƒ‰å±¥æ­´                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 14:32:01  â–¶ /status                     â”‚
â”‚ 14:32:01  âœ“ 5 tasks, 2 repos, 0 alerts â”‚
â”‚ 14:32:15  â–¶ /git                        â”‚
â”‚ 14:32:15  âœ“ Git status updated          â”‚
â”‚ 14:33:00  â–¶ hello                       â”‚
â”‚ 14:33:00  âœ“ Chat message sent           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 æŠ˜ã‚ŠãŸãŸã¿
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: æœ€æ–°3ä»¶è¡¨ç¤º
- ã‚¿ãƒƒãƒ—ã§å±•é–‹ï¼ˆæœ€å¤§20ä»¶ï¼‰

---

## Phase 4: WebSocket å¼·åŒ–

### 4.1 ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚­ãƒ£ãƒ—ãƒãƒ£
```tsx
ws.onerror = (event) => {
  const errorDetail = {
    code: event.type,
    message: 'æ¥ç¶šã‚¨ãƒ©ãƒ¼',
    timestamp: new Date(),
  };
  onError?.(errorDetail);
};
```

### 4.2 å†æ¥ç¶šãƒ—ãƒ­ã‚°ãƒ¬ã‚¹
```tsx
interface ReconnectState {
  attempt: number;
  maxAttempts: number;
  nextRetryIn: number; // seconds
}
```

### 4.3 æ¥ç¶šçŠ¶æ…‹ã®è©³ç´°åŒ–
```tsx
type ConnectionState =
  | 'connecting'
  | 'connected'
  | 'disconnected'
  | 'reconnecting'  // NEW
  | 'error';
```

---

## Phase 5: REST API ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 5.1 å€‹åˆ¥ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹
```tsx
interface FetchState {
  tasks: 'loading' | 'success' | 'error';
  repos: 'loading' | 'success' | 'error';
  alerts: 'loading' | 'success' | 'error';
}
```

### 5.2 ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ UI
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³ä»˜ã

---

## Phase 6: æ¥ç¶šã‚¨ãƒ©ãƒ¼æ™‚ã® UX

### 6.1 ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒãƒŠãƒ¼
```tsx
{!isConnected && (
  <div className="bg-red-500/10 border-red-500/30 p-3 text-center">
    <span>âš ï¸ æ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã¦ã„ã¾ã™</span>
    <button onClick={reconnect}>å†æ¥ç¶š</button>
    {retryState && (
      <span className="text-xs">
        ({retryState.attempt}/{retryState.maxAttempts})
        {retryState.nextRetryIn}ç§’å¾Œã«å†è©¦è¡Œ...
      </span>
    )}
  </div>
)}
```

### 6.2 ã‚³ãƒãƒ³ãƒ‰å…¥åŠ›ã®ã‚­ãƒ¥ãƒ¼
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã‚‚ã‚³ãƒãƒ³ãƒ‰å…¥åŠ›å¯èƒ½
- æ¥ç¶šå›å¾©å¾Œã«è‡ªå‹•é€ä¿¡
- ãƒˆãƒ¼ã‚¹ãƒˆã§é€šçŸ¥

---

## å®Ÿè£…å„ªå…ˆåº¦

| Phase | å†…å®¹ | ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ | å·¥æ•° |
|-------|------|-----------|------|
| 1 | ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ | â˜…â˜…â˜…â˜…â˜… | å° |
| 2 | CommandInput å¼·åŒ– | â˜…â˜…â˜…â˜…â˜† | ä¸­ |
| 3 | MessageLog | â˜…â˜…â˜…â˜†â˜† | ä¸­ |
| 4 | WebSocket å¼·åŒ– | â˜…â˜…â˜…â˜…â˜† | ä¸­ |
| 5 | REST API ã‚¨ãƒ©ãƒ¼ | â˜…â˜…â˜…â˜†â˜† | å° |
| 6 | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ UX | â˜…â˜…â˜†â˜†â˜† | å¤§ |

---

## æˆåŠŸæŒ‡æ¨™

### Before
- ã‚³ãƒãƒ³ãƒ‰é€ä¿¡ â†’ åå¿œãªã—ï¼ˆâŒï¼‰
- æ¥ç¶šã‚¨ãƒ©ãƒ¼ â†’ ã€Œã‚¨ãƒ©ãƒ¼ã€è¡¨ç¤ºã®ã¿ï¼ˆâŒï¼‰
- API ã‚¨ãƒ©ãƒ¼ â†’ ã‚µã‚¤ãƒ¬ãƒ³ãƒˆï¼ˆâŒï¼‰

### After
- ã‚³ãƒãƒ³ãƒ‰é€ä¿¡ â†’ ãƒˆãƒ¼ã‚¹ãƒˆ + ãƒ­ã‚°è¡¨ç¤ºï¼ˆâœ…ï¼‰
- æ¥ç¶šã‚¨ãƒ©ãƒ¼ â†’ è©³ç´° + å†æ¥ç¶šãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ï¼ˆâœ…ï¼‰
- API ã‚¨ãƒ©ãƒ¼ â†’ ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ã‚¨ãƒ©ãƒ¼è¡¨ç¤º + ãƒªãƒˆãƒ©ã‚¤ï¼ˆâœ…ï¼‰

---

## æŠ€è¡“é¸å®š

| æ©Ÿèƒ½ | ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ç†ç”± |
|------|-----------|------|
| ãƒˆãƒ¼ã‚¹ãƒˆ | sonner | è»½é‡ã€ç¾ã—ã„ã€React 18 å¯¾å¿œ |
| ã‚¢ã‚¤ã‚³ãƒ³ | lucide-react | æ—¢å­˜ä½¿ç”¨ã€ä¸€è²«æ€§ |
| ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ | Tailwind CSS | æ—¢å­˜ä½¿ç”¨ã€è¿½åŠ ä¸è¦ |
