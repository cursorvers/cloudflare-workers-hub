<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Limitless Pendant Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script>if(typeof Chart==='undefined'){document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.7/chart.umd.min.js"><\/script>')}</script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0f1117; color: #e0e0e0; }
  .header { background: linear-gradient(135deg, #1a1d2e 0%, #2d1f3d 100%); padding: 32px 40px; border-bottom: 1px solid #2a2d3e; }
  .header h1 { font-size: 28px; font-weight: 700; color: #fff; }
  .header p { color: #8b8fa3; margin-top: 4px; font-size: 14px; }
  .stats-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; padding: 24px 40px; }
  .stat-card { background: #1a1d2e; border: 1px solid #2a2d3e; border-radius: 12px; padding: 20px; }
  .stat-card .label { font-size: 12px; color: #8b8fa3; text-transform: uppercase; letter-spacing: 1px; }
  .stat-card .value { font-size: 32px; font-weight: 700; margin-top: 8px; }
  .stat-card .sub { font-size: 12px; color: #8b8fa3; margin-top: 4px; }
  .accent-blue .value { color: #4fc3f7; }
  .accent-green .value { color: #81c784; }
  .accent-purple .value { color: #b39ddb; }
  .accent-orange .value { color: #ffb74d; }
  .accent-pink .value { color: #f48fb1; }
  .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; padding: 0 40px 24px; }
  .chart-card { background: #1a1d2e; border: 1px solid #2a2d3e; border-radius: 12px; padding: 24px; }
  .chart-card h3 { font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #fff; }
  .full-width { grid-column: 1 / -1; }
  .two-thirds { grid-column: span 1; }
  canvas { max-height: 300px; }
  .topics-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 8px; }
  .topic-chip { background: #252836; border: 1px solid #3a3d4e; border-radius: 8px; padding: 8px 12px; font-size: 13px; display: flex; justify-content: space-between; align-items: center; }
  .topic-chip .count { background: #4fc3f7; color: #0f1117; border-radius: 10px; padding: 1px 8px; font-size: 11px; font-weight: 700; }
  .actions-list { list-style: none; }
  .actions-list li { padding: 10px 14px; border-left: 3px solid #4fc3f7; margin-bottom: 8px; background: #252836; border-radius: 0 8px 8px 0; font-size: 13px; line-height: 1.5; }
  .actions-list li:nth-child(even) { border-left-color: #b39ddb; }
  .pipeline-diagram { background: #252836; border-radius: 8px; padding: 20px; font-family: monospace; font-size: 13px; line-height: 2; color: #81c784; white-space: pre; overflow-x: auto; }
  @media (max-width: 1024px) {
    .stats-row { grid-template-columns: repeat(3, 1fr); }
    .charts-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<div class="header">
  <h1>Limitless Pendant Dashboard</h1>
  <p>FUGUE System - Voice Recording Pipeline Analytics | 2026-01-26 ~ 2026-01-28</p>
</div>

<div class="stats-row">
  <div class="stat-card accent-blue">
    <div class="label">Total Recordings</div>
    <div class="value">62</div>
    <div class="sub">3 days tracked</div>
  </div>
  <div class="stat-card accent-green">
    <div class="label">Total Duration</div>
    <div class="value">12.1h</div>
    <div class="sub">43,551 seconds</div>
  </div>
  <div class="stat-card accent-purple">
    <div class="label">Avg Duration</div>
    <div class="value">11:42</div>
    <div class="sub">per recording</div>
  </div>
  <div class="stat-card accent-orange">
    <div class="label">AI Processed</div>
    <div class="value">100%</div>
    <div class="sub">0 unprocessed</div>
  </div>
  <div class="stat-card accent-pink">
    <div class="label">Avg Confidence</div>
    <div class="value">0.81</div>
    <div class="sub">Workers AI (Llama 3.1)</div>
  </div>
</div>

<div class="charts-grid">

  <!-- Timeline Heatmap -->
  <div class="chart-card full-width">
    <h3>Recording Activity Timeline (JST)</h3>
    <canvas id="timelineChart"></canvas>
  </div>

  <!-- Classification Donut -->
  <div class="chart-card">
    <h3>Classification Distribution</h3>
    <canvas id="classificationChart"></canvas>
  </div>

  <!-- Duration by Classification -->
  <div class="chart-card">
    <h3>Total Time by Classification (min)</h3>
    <canvas id="durationChart"></canvas>
  </div>

  <!-- Hourly Activity (JST) -->
  <div class="chart-card">
    <h3>Hourly Activity Pattern (JST)</h3>
    <canvas id="hourlyChart"></canvas>
  </div>

  <!-- Sentiment -->
  <div class="chart-card">
    <h3>Sentiment Analysis</h3>
    <canvas id="sentimentChart"></canvas>
  </div>

  <!-- Duration Distribution -->
  <div class="chart-card">
    <h3>Recording Length Distribution</h3>
    <canvas id="durationDistChart"></canvas>
  </div>

  <!-- Daily Breakdown -->
  <div class="chart-card">
    <h3>Daily Breakdown by Classification (min)</h3>
    <canvas id="dailyChart"></canvas>
  </div>

  <!-- Topics -->
  <div class="chart-card">
    <h3>Extracted Topics (Top 20)</h3>
    <div class="topics-grid" id="topicsGrid"></div>
  </div>

  <!-- Action Items -->
  <div class="chart-card">
    <h3>Action Items (AI Extracted)</h3>
    <ul class="actions-list" id="actionsList"></ul>
  </div>

  <!-- Pipeline Diagram -->
  <div class="chart-card full-width">
    <h3>Data Pipeline Architecture</h3>
    <div class="pipeline-diagram">Limitless Pendant
    |  voice recording (always-on)
    v
Limitless.ai API (v1)
    |  metadata + markdown
    v
+--[Dual Sync Paths]--------------------------------------------+
|                                                                |
|  PATH 1: iOS Webhook (Primary)    PATH 2: Cron Backup (Hourly) |
|  iPhone Shortcut                   Cloudflare Cron 0 * * * *   |
|  POST /api/limitless/webhook-sync  handleLimitlessSync()       |
|  rate limit: 60/min                distributed lock (5min TTL) |
|  dedup: 10min gap                  interval: 1h               |
|                                                                |
+----------------------------------------------------------------+
    |
    v
Workers AI (@cf/meta/llama-3.1-8b-instruct)
    |  classification / summarization / sentiment / topics
    v
Supabase PostgreSQL (processed_lifelogs)
    |  upsert on limitless_id
    +--------+------------------+
    |        |                  |
    v        v                  v
Obsidian   Discord            Digest Reports
Vault      Notifications      weekly / monthly / annual
    </div>
  </div>

</div>

<script>
window.addEventListener('load', function() {
const colors = {
  casual:     { bg: 'rgba(79, 195, 247, 0.7)',  border: '#4fc3f7' },
  meeting:    { bg: 'rgba(129, 199, 132, 0.7)',  border: '#81c784' },
  insight:    { bg: 'rgba(255, 183, 77, 0.7)',   border: '#ffb74d' },
  reflection: { bg: 'rgba(179, 157, 219, 0.7)',  border: '#b39ddb' },
  brainstorm: { bg: 'rgba(244, 143, 177, 0.7)',  border: '#f48fb1' },
};

const defaultOpts = {
  responsive: true,
  maintainAspectRatio: true,
  plugins: {
    legend: { labels: { color: '#e0e0e0', font: { size: 12 } } },
  },
  scales: {
    x: { ticks: { color: '#8b8fa3' }, grid: { color: '#2a2d3e' } },
    y: { ticks: { color: '#8b8fa3' }, grid: { color: '#2a2d3e' } },
  }
};

// --- Timeline Chart ---
const timelineData = [
  { h: '1/26 12h', r: 1, d: 11 }, { h: '13h', r: 2, d: 577 }, { h: '15h', r: 2, d: 779 },
  { h: '16h', r: 3, d: 1276 }, { h: '17h', r: 2, d: 845 }, { h: '18h', r: 4, d: 1475 },
  { h: '19h', r: 3, d: 5867 }, { h: '21h', r: 3, d: 495 }, { h: '22h', r: 2, d: 72 },
  { h: '1/27 06h', r: 1, d: 561 }, { h: '07h', r: 2, d: 139 }, { h: '08h', r: 3, d: 446 },
  { h: '09h', r: 2, d: 2032 }, { h: '10h', r: 1, d: 22 }, { h: '11h', r: 3, d: 2169 },
  { h: '12h', r: 2, d: 2755 }, { h: '13h', r: 2, d: 3632 }, { h: '14h', r: 1, d: 3220 },
  { h: '15h', r: 2, d: 1075 }, { h: '16h', r: 3, d: 779 }, { h: '17h', r: 2, d: 871 },
  { h: '18h', r: 4, d: 7535 }, { h: '20h', r: 2, d: 443 }, { h: '21h', r: 1, d: 442 },
  { h: '22h', r: 4, d: 1038 }, { h: '1/28 06h', r: 2, d: 919 }, { h: '07h', r: 3, d: 4076 },
];

new Chart(document.getElementById('timelineChart'), {
  type: 'bar',
  data: {
    labels: timelineData.map(d => d.h),
    datasets: [
      { label: 'Recordings', data: timelineData.map(d => d.r), backgroundColor: 'rgba(79, 195, 247, 0.6)', yAxisID: 'y' },
      { label: 'Duration (min)', data: timelineData.map(d => Math.round(d.d / 60)), type: 'line', borderColor: '#f48fb1', backgroundColor: 'transparent', yAxisID: 'y1', tension: 0.3, pointRadius: 3 },
    ]
  },
  options: {
    ...defaultOpts,
    scales: {
      x: { ticks: { color: '#8b8fa3', maxRotation: 45 }, grid: { color: '#2a2d3e' } },
      y: { position: 'left', title: { display: true, text: 'Recordings', color: '#8b8fa3' }, ticks: { color: '#8b8fa3' }, grid: { color: '#2a2d3e' } },
      y1: { position: 'right', title: { display: true, text: 'Duration (min)', color: '#8b8fa3' }, ticks: { color: '#8b8fa3' }, grid: { drawOnChartArea: false } },
    }
  }
});

// --- Classification Donut ---
new Chart(document.getElementById('classificationChart'), {
  type: 'doughnut',
  data: {
    labels: ['casual (24)', 'meeting (23)', 'insight (8)', 'reflection (5)', 'brainstorm (2)'],
    datasets: [{
      data: [24, 23, 8, 5, 2],
      backgroundColor: [colors.casual.bg, colors.meeting.bg, colors.insight.bg, colors.reflection.bg, colors.brainstorm.bg],
      borderColor: [colors.casual.border, colors.meeting.border, colors.insight.border, colors.reflection.border, colors.brainstorm.border],
      borderWidth: 2,
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { position: 'right', labels: { color: '#e0e0e0', padding: 12, font: { size: 12 } } },
    }
  }
});

// --- Duration by Classification ---
new Chart(document.getElementById('durationChart'), {
  type: 'bar',
  data: {
    labels: ['meeting', 'casual', 'insight', 'reflection', 'brainstorm'],
    datasets: [{
      label: 'Total minutes',
      data: [299, 160, 114, 99, 54],
      backgroundColor: [colors.meeting.bg, colors.casual.bg, colors.insight.bg, colors.reflection.bg, colors.brainstorm.bg],
      borderColor: [colors.meeting.border, colors.casual.border, colors.insight.border, colors.reflection.border, colors.brainstorm.border],
      borderWidth: 1,
    }]
  },
  options: { ...defaultOpts, indexAxis: 'y', plugins: { legend: { display: false } } }
});

// --- Hourly Pattern ---
const hours = [6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22];
const hourlyCounts = [3,5,3,2,1,3,3,4,1,4,6,4,8,3,2,4,6];
const hourlyMinutes = [25,70,7,34,0,36,46,70,54,31,34,29,150,98,7,16,19];

new Chart(document.getElementById('hourlyChart'), {
  type: 'bar',
  data: {
    labels: hours.map(h => h + ':00'),
    datasets: [
      { label: 'Recordings', data: hourlyCounts, backgroundColor: 'rgba(79, 195, 247, 0.5)', yAxisID: 'y' },
      { label: 'Duration (min)', data: hourlyMinutes, type: 'line', borderColor: '#ffb74d', backgroundColor: 'transparent', yAxisID: 'y1', tension: 0.3 },
    ]
  },
  options: {
    ...defaultOpts,
    scales: {
      x: { ticks: { color: '#8b8fa3' }, grid: { color: '#2a2d3e' } },
      y: { position: 'left', ticks: { color: '#8b8fa3' }, grid: { color: '#2a2d3e' } },
      y1: { position: 'right', ticks: { color: '#8b8fa3' }, grid: { drawOnChartArea: false } },
    }
  }
});

// --- Sentiment ---
new Chart(document.getElementById('sentimentChart'), {
  type: 'polarArea',
  data: {
    labels: ['neutral (43)', 'positive (14)', 'negative (3)'],
    datasets: [{
      data: [43, 14, 3],
      backgroundColor: ['rgba(79, 195, 247, 0.5)', 'rgba(129, 199, 132, 0.5)', 'rgba(244, 143, 177, 0.5)'],
      borderColor: ['#4fc3f7', '#81c784', '#f48fb1'],
      borderWidth: 2,
    }]
  },
  options: {
    responsive: true,
    plugins: { legend: { position: 'right', labels: { color: '#e0e0e0', font: { size: 12 } } } },
    scales: { r: { ticks: { color: '#8b8fa3' }, grid: { color: '#2a2d3e' } } }
  }
});

// --- Duration Distribution ---
new Chart(document.getElementById('durationDistChart'), {
  type: 'bar',
  data: {
    labels: ['< 1min', '1-5min', '5-10min', '10-30min', '30-60min', '60min+'],
    datasets: [
      { label: 'casual', data: [8,5,7,3,1,0], backgroundColor: colors.casual.bg },
      { label: 'meeting', data: [4,9,4,4,0,2], backgroundColor: colors.meeting.bg },
      { label: 'insight', data: [1,2,3,1,1,0], backgroundColor: colors.insight.bg },
      { label: 'reflection', data: [0,0,2,2,1,0], backgroundColor: colors.reflection.bg },
      { label: 'brainstorm', data: [0,0,0,1,1,0], backgroundColor: colors.brainstorm.bg },
    ]
  },
  options: { ...defaultOpts, scales: { ...defaultOpts.scales, x: { stacked: true, ticks: { color: '#8b8fa3' }, grid: { color: '#2a2d3e' } }, y: { stacked: true, ticks: { color: '#8b8fa3' }, grid: { color: '#2a2d3e' } } } }
});

// --- Daily Breakdown ---
new Chart(document.getElementById('dailyChart'), {
  type: 'bar',
  data: {
    labels: ['1/26 (Sun)', '1/27 (Mon)', '1/28 (Tue)'],
    datasets: [
      { label: 'casual', data: [46, 31, 83], backgroundColor: colors.casual.bg },
      { label: 'meeting', data: [81, 218, 0], backgroundColor: colors.meeting.bg },
      { label: 'insight', data: [51, 64, 0], backgroundColor: colors.insight.bg },
      { label: 'reflection', data: [0, 99, 0], backgroundColor: colors.reflection.bg },
      { label: 'brainstorm', data: [13, 41, 0], backgroundColor: colors.brainstorm.bg },
    ]
  },
  options: { ...defaultOpts, scales: { ...defaultOpts.scales, x: { stacked: true, ticks: { color: '#8b8fa3' }, grid: { color: '#2a2d3e' } }, y: { stacked: true, title: { display: true, text: 'minutes', color: '#8b8fa3' }, ticks: { color: '#8b8fa3' }, grid: { color: '#2a2d3e' } } } }
});

// --- Topics ---
const topics = [
  ['留年', 4], ['卒業', 2], ['課題', 2], ['再試験', 2], ['確認', 2],
  ['雑談', 2], ['電車の運行', 2], ['注意事項', 2], ['自己紹介', 2], ['アナウンス', 2],
  ['目標設定', 1], ['進捗管理', 1], ['組織構築', 1], ['コスト効率化', 1], ['リーダーシップ', 1],
  ['AIエージェントスキル', 1], ['動画マニュアル', 1], ['金銭トラブル', 1], ['在庫管理', 1], ['日常生活', 1],
];
const grid = document.getElementById('topicsGrid');
topics.forEach(([t, c]) => {
  const el = document.createElement('div');
  el.className = 'topic-chip';
  el.innerHTML = `<span>${t}</span><span class="count">${c}</span>`;
  grid.appendChild(el);
});

// --- Action Items ---
const actions = [
  '1週間後に進捗を報告すること',
  'ゴール設定を具体化し、責任者に確認すること',
  '動画マニュアルを概要欄に載せる',
  'AIエージェントスキルを試してみる',
  '2月のライトニングトークイベントに参加するための登録を進めること',
  '3月のCTOパネルディスカッションに向けて情報を収集し登録を行うこと',
  '契約書・借用書の有無を確認する',
  'データ化と子供食堂を実施する',
  '1号店のところでスモールスタートする',
  '卒業要件を確認する',
  '救済試験の可能性について調査する',
  '2月からの進め方について議論する',
];
const list = document.getElementById('actionsList');
actions.forEach(a => {
  const li = document.createElement('li');
  li.textContent = a;
  list.appendChild(li);
});
}); // end window.onload
</script>
</body>
</html>
